{% extends "base.html" %}
{% load ratings %}
{% load static %}



{% block title %}
	{{ product.author }} - {{ product.name }}
{% endblock %}

{% block content %}
	<div class="row pt-5 pb-5">
		<div class="card bg-dark text-white">
			<div class="row no-gutters">
				<div class="col-md-4">
					<div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
						{% if images.count > 1 %}
							<ol class="carousel-indicators">
								{% for i in images %}
									<li data-target="#carouselExampleIndicators" 
										class="
										{% if forloop.counter|add:'-1' == 0 %}
										active
										{% endif %}
										"
										data-slide-to="{{ forloop.counter|add:'-1' }}">
									</li>
								{% endfor %}
							</ol>
						{% endif %}

						<div class="carousel-inner">
							{% for prev_image in images %}
								{% if prev_image.preview %}
									<div class="carousel-item active">
										<img src="{{ prev_image.image.url }}" class="d-block w-100" alt="...">
									</div>
								{% endif %}
							{% endfor %}

							{% if images.count > 1 %}
								{% for image in images %}
									{% if image.preview != True %}
										<div class="carousel-item">
											<img src="{{ image.image.url }}" class="d-block w-100" alt="...">
										</div>
									{% endif %}
								{% endfor %}
							{% endif %}
						</div>
						{% if images.count > 1 %}
							<a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
								<span class="carousel-control-prev-icon" aria-hidden="true"></span>
								<span class="sr-only">Previous</span>
							</a>
							<a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
								<span class="carousel-control-next-icon" aria-hidden="true"></span>
								<span class="sr-only">Next</span>
							</a>
						{% endif %}
					</div>
				</div>
				<div class="col-md-8">
					<div class="card-body">
						<h5 class="card-title">{{ product.name }}</h5>
							{% ratings product %}
							<p class="card-text">{{ product.description | linebreaks}}</p>
							<div class="card_btns">
								<div>
									<a href="#" class="btn btn-outline-success btn-sm"><span>{{ product.price }} руб.</span> | Приобрести</a> 
								</div>
								{% if user.username != product.author.username %}
								    <form action="{% url 'cart:CartAdd' product.id %}" method="post">
										{% if error %}
											<button disabled><i class="fas fa-shopping-cart"></i></button>
										   	<p>{{ error }}</p>
										{% else %}
											{% csrf_token %}
											<button type="submit"><i class="fas fa-shopping-cart"></i></button>
										{% endif %}
									    
									</form>
								{% endif %}
								<div class="btn_author">
									<a href="#" class="btn btn-outline-light btn-sm">{{ product.author.first_name }} {{ product.author.last_name }} | {{ product.created|date:"d.m.y" }}</a>

								</div>
							</div>
					</div>
				</div>
			</div>
		</div>

	</div>
{% endblock content %}